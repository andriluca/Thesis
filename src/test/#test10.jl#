## NON FUNZIONA IL DIODO

# Modello
using ModelingToolkit, ModelingToolkitStandardLibrary.Electrical
using ModelingToolkitStandardLibrary.Blocks: Constant, Sine
using DifferentialEquations

# Grafici
using Plots, PlotThemes, Plots.PlotMeasures



@mtkmodel System begin
    @components begin
        # Sorgenti del segnale e ground.
        gen    = Sine(frequency = .5)
        source = Voltage()
        ground = Ground()
        # Componenti
        R = Resistor(R = 1)
        D = Diode(V_th = 0.5)
    end
    @equations begin
        connect(gen.output, source.V)
        connect(source.p, D.p)
        connect(D.n, R.p)
        connect(R.n, source.n, ground.g)
    end
end

# Istanzio il modello (parametri esclusi).
@mtkbuild system = System()
## genero un problema da risolvere nell'intervallo 0-10s.
prob = ODEProblem(system, [], (0, 10.0))
## modifico le tolleranze della soluzione.
sol = solve(prob, reltol = 1e-10, abstol = 1e-8)

plot(sol, idxs = [system.D.i])
